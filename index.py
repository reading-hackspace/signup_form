#! /usr/bin/python2.6 -OO
# -*- coding: utf-8 -*-
import os
print """Content-Type: text/html; charset=UTF-8

<!DOCTYPE html>
<html>
    <head>
        <style type="text/css">
h1, p, input, select, textarea, button {font-family: Courier,"Courier New",monospace;}
img {vertical-align:middle}
label {display:inline-block; width:10em;}
form {display:block; width:40em; margin:auto;}
div#content {width:30em; margin:auto;}
select, input {width:20em; border:1px solid black;}
textarea {width:30em; height:4em; border:1px solid black;}
button {border:2px solid black; background:white; color:black;}
button#submit {border:3px solid black; font-weight: bold;}
video, canvas {border:5px solid black; display:none;}
        </style>
    </head>
    <body>
        <form action="signup.py" enctype="multipart/form-data" method="post" id="form">
            <h1><img src="wiki.png" alt=""/> rlab - Reading Hackspace</h1>
            <div id="content">
                <p>
                    <select name="id">
                        <option disabled selected>Card id…</option>
"""
for line in os.popen("ssh gilliam@bridgeofdeath.rlab.org.uk").readlines():
	print """<option value="%s">%s</option>""" % (line, line[:-5])
print """


                    </select>
                </p>
                <p>
                    <input name="name" placeholder="Full name …" required="required"/>
                </p>
                <p>
                    <input type="email" name="email" placeholder="Email …" required="required"/>
                </p>
                <p>
                    <input id="postcode" name="postcode" placeholder="Post code …" required="required"/>
                    <button type="button" id="find">Find Address</button>
                </p>
                <div id="address"></div>
                <p><textarea placeholder="Address …" id="address1" name="address" required="required"></textarea></p>
                <p>
                    <input type="file" name="photo" id="photo" accept="image/*">
                    <video id="video" autoplay="autoplay" width="320" height="240"></video>
                    <canvas id="canvas0p" width="320" height="240"></canvas>
                    <canvas id="canvas0" width="640" height="480" ></canvas>
                    <button id="snapbut" type="button" style="display:none;">Snap</button>
                <p>
                <p style="text-align:center">
                    <button id="submit" type="submit">Join</button>
                </p>
        </form>
    </body>
<script type="text/javascript">
"use strict";
// webcam.js © 2013 b@zi.is GPLv2 */
// drop.js © 2013 b@zi.is GPLv2 */
/*!
// This is a collection of JavaScript code to allow easy integration of 
// postcode / address finder functionality into any website
//
// Provided by www.CraftyClicks.co.uk
//
// Version - 4.9.1 (23/03/2011)
//
// Feel free to copy/use/modify this code any way you see fit. Please keep this
// comment header in place when you do.
//
// To integrate UK postcode / address lookup on your website, please visit www.craftyclicks.co.uk for
// details of how to sign up for an account.
//
**********************************************************************************/
// postcode.js © 2013 b@zi.is GPLv2 */
function dataURItoBlob(e){var t,r;t=-1!==e.split(",")[0].indexOf("base64")?atob(e.split(",")[1]):decodeURI(e.split(",")[1]),r=e.split(",")[0].split(":")[1].split(";")[0];for(var s=new ArrayBuffer(t.length),i=new Uint8Array(s),a=0;a<t.length;a++)i[a]=t.charCodeAt(a);return new Blob([s],{type:r})}function snap_preview(){document.getElementById("video").style.display="inline-block",document.getElementById("canvas0p").style.display="none"}function snap_nopreview(){document.getElementById("video").style.display="none",document.getElementById("canvas0p").style.display="inline-block"}function snap(){var e=document.getElementById("canvas0"),t=document.getElementById("canvas0p"),r=document.getElementById("video");return e.getContext("2d").drawImage(r,0,0,r.videoWidth,r.videoHeight,0,0,e.width,e.height),t.getContext("2d").drawImage(r,0,0,e.width,e.height,0,0,t.width,t.height),snap_nopreview(),window.haspic=!0,!1}function addimg(e){if(e.preventDefault(),!window.haspic)return alert("Please include a photo."),!1;var t=document.getElementById("canvas0"),r=new FormData(document.forms[0]);r.append("photo",dataURItoBlob(t.toDataURL("image/jpeg",.8)));var s=new XMLHttpRequest;return s.open("POST",document.forms[0].action,!0),s.onload=function(){200==s.status?(alert("Thank you."),location.reload()):alert("Submit failed, please try again!")},s.send(r),!1}function CraftyPostcodeCreate(){return _cp_instance_idx++,_cp_instances[_cp_instance_idx]=new CraftyPostcodeClass,_cp_instances[_cp_instance_idx].obj_idx=_cp_instance_idx,_cp_instances[_cp_instance_idx]}function _cp_sp(e){var t,r="";for(t=0;t<_cp_pl.length;t++)if(r=_cp_pl[t],r==e.substr(0,r.length).toUpperCase())return e.substr(r.length);return""}function _cp_eh(e){for(var t="";t=e.shift();)if(!isNaN(parseInt(t)))return parseInt(t);return""}function _cp_kp(e){var t;e||(e=window.event),e.keyCode?t=e.keyCode:e.which&&(t=e.which),13==t&&this.onclick()}function CraftyPostcodeClass(){this.config={lookup_url:"pcls1.craftyclicks.co.uk/js/",access_token:"",basic_address:0,traditional_county:0,busy_img_url:"crafty_postcode_busy.gif",hide_result:0,org_uppercase:1,town_uppercase:1,county_uppercase:0,addr_uppercase:0,delimiter:", ",msg1:"Please wait while we find the address",err_msg1:"This postcode could not be found, please try again or enter your address manually",err_msg2:"This postcode is not valid, please try again or enter your address manually",err_msg3:"Unable to connect to address lookup server, please enter your address manually.",err_msg4:"An unexpected error occured, please enter your address manually.",res_autoselect:1,res_select_on_change:1,debug_mode:0,lookup_timeout:1e4,form:"",elements:"",max_width:"400px",max_lines:1,first_res_line:"---- please select your address ----",result_elem_id:"",on_result_ready:null,on_result_selected:null,on_error:null,pre_populate_common_address_parts:0,elem_company:"crafty_out_company",elem_house_num:"",elem_street1:"crafty_out_street1",elem_street2:"crafty_out_street2",elem_street3:"crafty_out_street3",elem_town:"crafty_out_town",elem_county:"crafty_out_county",elem_postcode:"crafty_in_out_postcode",elem_udprn:"crafty_out_udprn",single_res_autoselect:0,single_res_notice:"---- address found, see below ----",elem_search_house:"crafty_in_search_house",elem_search_street:"crafty_in_search_street",elem_search_town:"crafty_in_search_town",max_results:25,err_msg5:"The house name/number could not be found, please try again.",err_msg6:"No results found, please modify your search and try again.",err_msg7:"Too many results, please modify your search and try again.",err_msg9:"Please provide more data and try again.",err_msg8:"Trial account limit reached, please use AA11AA, AA11AB, AA11AD or AA11AE."},this.xmlhttp=null,this.res_arr=null,this.disp_arr=null,this.res_arr_idx=0,this.dummy_1st_line=0,this.cc=0,this.flexi_search=0,this.lookup_timeout=null,this.obj_name="",this.house_search=0,this.set=function(e,t){this.config[e]=t},this.res_clicked=function(e){this.cc++,this.res_selected(e)&&0!=this.config.hide_result&&(2>=this.config.max_lines&&1<this.cc||2<this.config.max_lines)&&(this.update_res(null),this.cc=0)},this.res_selected=function(e){if(1==this.dummy_1st_line){if(0==e)return 0;e--}return e=this.disp_arr[e].index,this.populate_form_fields(this.res_arr[e]),this.config.on_result_selected&&this.config.on_result_selected(e),1},this.populate_form_fields=function(e){for(var t=[],r=this.config.delimiter,s=0;8>s;s++)t[s]=this.get_elem(s);t[11]=this.get_elem(11),t[11]&&(t[11].value=e.udprn),t[0]&&(t[0]==t[1]&&""!=e.org?(t[1].value=e.org,t[1]=t[2],t[2]=t[3],t[3]=null):t[0].value=e.org);var i=e.housename2;""!=i&&""!=e.housename1&&(i+=r),i+=e.housename1;var a=e.housenumber;t[7]&&(t[7].value=i,""!=i&&""!=a&&(t[7].value+=r),t[7].value+=a,i="",a="");var n=e.street1,o=e.street2;""!=a&&(""!=o?o=a+" "+o:n=""!=n?a+" "+n:a);var c=o+(""==o?"":""==n?"":r)+n,l=e.locality_dep,_=e.locality;""!=c&&parseInt(c)==c&&(""!=l?l=parseInt(c)+" "+l:_=parseInt(c)+" "+_,c="",n="");var u=l+(""==l||""==_?"":r)+_,d=c+(""==c||""==u?"":r)+u;if(t[1]&&t[2]&&t[3])""!=e.pobox||""!=i?(t[1].value=""!=e.pobox?e.pobox:i,""==u?""==o?(t[2].value=n,t[3].value=""):(t[2].value=o,t[3].value=n):""==c?""==l?(t[2].value=_,t[3].value=""):(t[2].value=l,t[3].value=_):(t[2].value=c,t[3].value=u)):""==c?""==l?(t[1].value=_,t[2].value="",t[3].value=""):(t[1].value=l,t[2].value=_,t[3].value=""):""==u?""==o?(t[1].value=n,t[2].value="",t[3].value=""):(t[1].value=o,t[2].value=n,t[3].value=""):""==o?(t[1].value=n,""==l?(t[2].value=_,t[3].value=""):(t[2].value=l,t[3].value=_)):""==l?(t[1].value=o,t[2].value=n,t[3].value=_):c.length<u.length?(t[1].value=c,t[2].value=l,t[3].value=_):(t[1].value=o,t[2].value=n,t[3].value=u);else if(t[1]&&t[2])""!=e.pobox?(t[1].value=e.pobox,t[2].value=d):""!=i&&""!=c&&""!=u?i.length+c.length<c.length+u.length?(t[1].value=i+(""==i?"":r)+c,t[2].value=u):(t[1].value=i,t[2].value=c+(""==c?"":r)+u):""!=i&&""!=c?(t[1].value=i,t[2].value=c):""==i&&""!=c?""==u?""!=o?(t[1].value=o,t[2].value=n):(t[1].value=c,t[2].value=""):(t[1].value=c,t[2].value=u):""==c&&""!=i?(t[1].value=i,t[2].value=u):(t[1].value=u,t[2].value="");else{var h;h=t[1]?t[1]:t[2]?t[2]:t[3],h.value=""!=e.pobox?e.pobox+r+u:i+(""==i||""==d?"":r)+d}return t[4]&&(t[4].value=e.town),t[5]&&(t[5].value=e.county),t[6]&&(t[6].value=e.postcode),1},this.show_busy=function(){var e=document.createElement("img"),t=document.createAttribute("src");t.value=this.config.busy_img_url,e.setAttributeNode(t),t=document.createAttribute("title"),t.value=this.config.msg1,e.setAttributeNode(t),this.update_res(e)},this.disp_err=function(e,t){var r=null,s="";if(""!=e){switch(e){case"0001":s=this.config.err_msg1;break;case"0002":s=this.config.err_msg2;break;case"9001":s=this.config.err_msg3;break;case"0003":s=this.config.err_msg9;break;case"0004":s=this.config.err_msg6;break;case"0005":s=this.config.err_msg7;break;case"7001":s=this.config.err_msg8;break;default:s="("+e+") "+this.config.err_msg4}if(this.config.debug_mode){var i="";switch(e){case"8000":i=" :: No Access Token ";break;case"8001":i=" :: Invalid Token Format ";break;case"8002":i=" :: Invalid Token ";break;case"8003":i=" :: Out of Credits ";break;case"8004":i=" :: Restricted by rules ";break;case"8005":i=" :: Token suspended "}s+=i+" :: DBG :: "+t}r=document.createTextNode(s)}this.update_res(r),this.config.on_error&&this.config.on_error(s)},this.disp_err_msg=function(e){var t=null;""!=e&&(t=document.createTextNode(e)),this.update_res(t),this.config.on_error&&this.config.on_error(e)},this.display_res_line=function(e){var t=document.getElementById("crafty_postcode_lookup_result_option"+this.obj_idx),r=document.createElement("option");if(r.appendChild(document.createTextNode(e)),null!=t)t.appendChild(r);else{var s=document.createElement("select");s.id="crafty_postcode_lookup_result_option"+this.obj_idx,s.onclick=Function("_cp_instances["+this.obj_idx+"].res_clicked(this.selectedIndex);"),s.onkeypress=_cp_kp,0!=this.config.res_select_on_change&&(s.onchange=Function("_cp_instances["+this.obj_idx+"].res_selected(this.selectedIndex);")),this.config.max_width&&""!=this.config.max_width&&(s.style.width=this.config.max_width);var i=this.res_arr_idx;1==this.dummy_1st_line&&i++,s.size="Microsoft Internet Explorer"==navigator.appName&&parseFloat(navigator.appVersion)<=4?0:i>=this.config.max_lines?this.config.max_lines:i,s.appendChild(r),this.update_res(s)}},this.update_res=function(e){this.lookup_timeout&&clearTimeout(this.lookup_timeout);try{if(document.getElementById){var t=document.getElementById(this.config.result_elem_id);if(t.hasChildNodes())for(;t.firstChild;)t.removeChild(t.firstChild);null!=e&&t.appendChild(e)}}catch(r){}},this.str_trim=function(e){for(var t=0,r=e.length-1;t<e.length&&" "==e[t];)t++;for(;r>t&&" "==e[r];)r-=1;return e.substring(t,r+1)},this.cp_uc=function(e){if("PC"==e||"UK"==e||"EU"==e)return e;for(var t="ABCDEFGHIJKLMNOPQRSTUVWXYZ",r="",s=1,i=0,a=0;a<e.length;a++)if(-1!=t.indexOf(e.charAt(a)))s||i?(r+=e.charAt(a),s=0):r+=e.charAt(a).toLowerCase();else if(r+=e.charAt(a),a+2>=e.length&&"'"==e.charAt(a))s=0;else if("("==e.charAt(a)){var n=e.indexOf(")",a+1);n>a+3?(i=0,s=1):i=1}else if(")"==e.charAt(a))i=0,s=1;else if("-"==e.charAt(a)){var n=e.indexOf("-",a+1);-1!=n&&a+3>=n||a+3>=e.length?(i=0,s=0):(i=0,s=1)}else s=a+2<e.length&&"0"<=e.charAt(a)&&"9">=e.charAt(a)?0:1;return r},this.leading_caps=function(e,t){if(0!=t||2>e.length)return e;for(var r="",s=e.split(" "),i=0;i<s.length;i++){var a=this.str_trim(s[i]);""!=a&&(""!=r&&(r+=" "),r+=this.cp_uc(a))}return r},this.new_res_line=function(){var e=[];return e.org="",e.housename1="",e.housename2="",e.pobox="",e.housenumber="",e.street1="",e.street2="",e.locality_dep="",e.locality="",e.town="",e.county="",e.postcode="",e.udprn="",e},this.res_arr_compare=function(e,t){if(e.match_quality>t.match_quality)return 1;if(e.match_quality<t.match_quality)return-1;if(e.street1>t.street1)return 1;if(e.street1<t.street1)return-1;if(e.street2>t.street2)return 1;if(e.street2<t.street2)return-1;var r;r=""==e.housenumber?_cp_eh(Array(e.housename1,e.housename2)):parseInt(e.housenumber);var s;if(s=""==t.housenumber?_cp_eh(Array(t.housename1,t.housename2)):parseInt(t.housenumber),""==r&&""!=s)return 1;if(""!=r&&""==s)return-1;if(r>s)return 1;if(s>r)return-1;var i=_cp_sp(e.housename1);isNaN(parseInt(i))||(i=parseInt(i));var a=_cp_sp(t.housename1);if(isNaN(parseInt(a))||(a=parseInt(a)),i>a)return 1;if(a>i)return-1;var i=_cp_sp(e.housename2);isNaN(parseInt(i))||(i=parseInt(i));var a=_cp_sp(t.housename2);return isNaN(parseInt(a))||(a=parseInt(a)),i>a?1:a>i?-1:(i=e.housename2+e.housename1,a=t.housename2+t.housename1,i>a?1:a>i?-1:e.org>t.org?1:e.org<t.org?-1:1)},this.disp_res_arr=function(){this.res_arr=this.res_arr.sort(this.res_arr_compare),0!=this.config.res_autoselect&&this.populate_form_fields(this.res_arr[0]);var e=this.config.delimiter;this.disp_arr=[];for(var t=0;t<this.res_arr_idx;t++){var r=this.res_arr[t],s=r.org+(""!=r.org?e:"")+r.housename2+(""!=r.housename2?e:"")+r.housename1+(""!=r.housename1?e:"")+r.pobox+(""!=r.pobox?e:"")+r.housenumber+(""!=r.housenumber?" ":"")+r.street2+(""!=r.street2?e:"")+r.street1+(""!=r.street1?e:"")+r.locality_dep+(""!=r.locality_dep?e:"")+r.locality+(""!=r.locality?e:"")+r.town;this.flexi_search&&(s+=e+r.postcode);var i=[];i.index=t,i.str=s,this.disp_arr[t]=i}this.dummy_1st_line=0,""!=this.config.first_res_line&&(this.dummy_1st_line=1,this.display_res_line(this.config.first_res_line,-1));for(var t=0;t<this.res_arr_idx;t++)this.display_res_line(this.disp_arr[t].str,t);if(this.config.pre_populate_common_address_parts){var a=this.new_res_line();a.org=this.res_arr[0].org,a.housename1=this.res_arr[0].housename1,a.housename2=this.res_arr[0].housename2,a.pobox=this.res_arr[0].pobox,a.housenumber=this.res_arr[0].housenumber,a.street1=this.res_arr[0].street1,a.street2=this.res_arr[0].street2,a.locality_dep=this.res_arr[0].locality_dep,a.locality=this.res_arr[0].locality,a.town=this.res_arr[0].town,a.county=this.res_arr[0].county,a.postcode=this.res_arr[0].postcode,a.udprn=this.res_arr[0].udprn;for(var t=1;t<this.res_arr_idx;t++)this.res_arr[t].org!=a.org&&(a.org=""),this.res_arr[t].housename2!=a.housename2&&(a.housename2=""),this.res_arr[t].housename1!=a.housename1&&(a.housename1=""),this.res_arr[t].pobox!=a.pobox&&(a.pobox=""),this.res_arr[t].housenumber!=a.housenumber&&(a.housenumber=""),this.res_arr[t].street1!=a.street1&&(a.street1=""),this.res_arr[t].street2!=a.street2&&(a.street2=""),this.res_arr[t].locality_dep!=a.locality_dep&&(a.locality_dep=""),this.res_arr[t].locality!=a.locality&&(a.locality=""),this.res_arr[t].town!=a.town&&(a.town=""),this.res_arr[t].county!=a.county&&(a.county=""),this.res_arr[t].postcode!=a.postcode&&(a.postcode=""),this.res_arr[t].udprn!=a.udprn&&(a.udprn="");this.populate_form_fields(a)}},this.get_elem=function(e){var t="",r=null;if(""!=this.config.elements){var s=this.config.elements.split(",");t=s[e]}else switch(e){case 0:t=this.config.elem_company;break;case 1:t=this.config.elem_street1;break;case 2:t=this.config.elem_street2;break;case 3:t=this.config.elem_street3;break;case 4:t=this.config.elem_town;break;case 5:t=this.config.elem_county;break;case 6:default:t=this.config.elem_postcode;break;case 7:t=this.config.elem_house_num;break;case 8:t=this.config.elem_search_house;break;case 9:t=this.config.elem_search_street;break;case 10:t=this.config.elem_search_town;break;case 11:t=this.config.elem_udprn}return""!=t&&(""!=this.config.form?r=document.forms[this.config.form].elements[t]:document.getElementById&&(r=document.getElementById(t))),r},this.doHouseSearch=function(){var e=this.get_elem(8);e&&0<e.value.length&&(this.house_search=1),this.doLookup()},this.doLookup=function(){this.xmlhttp=null;var e=this.get_elem(6),t=null;e&&(this.show_busy(),this.lookup_timeout=setTimeout("_cp_instances["+this.obj_idx+"].lookup_timeout_err()",this.config.lookup_timeout),t=this.validate_pc(e.value)),null!=t?this.direct_xml_fetch(0,t):this.disp_err("0002","invalid postcode format")},this.flexiSearch=function(){this.xmlhttp=null;var e="";this.get_elem(8)&&""!=this.get_elem(8).value&&(e+="&search_house="+this.get_elem(8).value),this.get_elem(9)&&""!=this.get_elem(9).value&&(e+="&search_street="+this.get_elem(9).value),this.get_elem(10)&&""!=this.get_elem(10).value&&(e+="&search_town="+this.get_elem(10).value),""!=e?(this.show_busy(),this.lookup_timeout=setTimeout("_cp_instances["+this.obj_idx+"].lookup_timeout_err()",this.config.lookup_timeout),this.direct_xml_fetch(1,e)):this.disp_err("0003","search string too short")},this.validate_pc=function(e){var t="";do t=e,e=e.replace(/[^A-Za-z0-9]/,"");while(t!=e);if(t=e.toUpperCase(),7>=t.length&&5<=t.length){var r=t.substring(t.length-3,t.length),s=t.substring(0,t.length-3);if(1==/[CIKMOV]/.test(r))return null;if("0"<=r.charAt(0)&&"9">=r.charAt(0)&&"A"<=r.charAt(1)&&"Z">=r.charAt(1)&&"A"<=r.charAt(2)&&"Z">=r.charAt(2))switch(s.length){case 2:if("A"<=s.charAt(0)&&"Z">=s.charAt(0)&&"0"<=s.charAt(1)&&"9">=s.charAt(1))return t;break;case 3:if("A"<=s.charAt(0)&&"Z">=s.charAt(0)){if("0"<=s.charAt(1)&&"9">=s.charAt(1)&&"0"<=s.charAt(2)&&"9">=s.charAt(2))return t;if("A"<=s.charAt(1)&&"Z">=s.charAt(1)&&"0"<=s.charAt(2)&&"9">=s.charAt(2))return t;if("0"<=s.charAt(1)&&"9">=s.charAt(1)&&"A"<=s.charAt(2)&&"Z">=s.charAt(2))return t}break;case 4:if("A"<=s.charAt(0)&&"Z">=s.charAt(0)&&"A"<=s.charAt(1)&&"Z">=s.charAt(1)&&"0"<=s.charAt(2)&&"9">=s.charAt(2)){if("0"<=s.charAt(3)&&"9">=s.charAt(3))return t;if("A"<=s.charAt(3)&&"Z">=s.charAt(3))return t}}}return null},this.direct_xml_fetch=function(e,t){try{var r=document.getElementById(this.config.result_elem_id),s="";if(s="https:"==document.location.protocol?"https://":"http://",0==e)s+=this.config.lookup_url,s+=this.config.basic_address?"basicaddress":"rapidaddress",s+="?postcode="+t+"&callback=_cp_instances["+this.obj_idx+"].handle_js_response&callback_id=0";else{if(this.config.basic_address)return void this.disp_err("1207","BasicAddress can't be used for Flexi Search!");s+=this.config.lookup_url+"flexiaddress?callback=_cp_instances["+this.obj_idx+"].handle_js_response&callback_id=1",s+="&max_results="+this.config.max_results,s+=t}""!=this.config.access_token&&(s+="&key="+this.config.access_token);var i=document.createElement("script");i.src=encodeURI(s),i.type="text/javascript",r.appendChild(i)}catch(a){this.disp_err("1206",a)}},this.handle_js_response=function(e,t,r){if(t){if(this.res_arr=[],this.res_arr_idx=0,0==e){if(this.flexi_search=0,this.house_search&&(r=this.filter_data_by_house_name(r),null==r))return void this.disp_err_msg(this.config.err_msg5);this.add_to_res_array(r)}else{this.flexi_search=1,this.res_arr.total_postcode_count=r.total_postcode_count,this.res_arr.total_thoroughfare_count=r.total_thoroughfare_count,this.res_arr.total_delivery_point_count=r.total_delivery_point_count;for(var s=1;s<=r.total_postcode_count;s++)this.add_to_res_array(r[s])}if(this.res_arr_idx){var i=!1;if(1==this.res_arr_idx&&this.config.single_res_autoselect){var a=null;""!=this.config.single_res_notice&&(a=document.createTextNode(this.config.single_res_notice)),this.update_res(a),this.populate_form_fields(this.res_arr[0]),i=!0}else this.disp_res_arr(),document.getElementById("crafty_postcode_lookup_result_option"+this.obj_idx).focus();if(0==e&&""!=r.postcode){var n=this.get_elem(6);n.value=r.postcode}this.config.on_result_ready&&this.config.on_result_ready(),i&&this.config.on_result_selected&&this.config.on_result_selected(0)}else this.disp_err("1205","no result to display")}else{var o=r.error_code,c=r.error_msg;this.disp_err(o,c)}},this.add_to_res_array=function(e){for(var t=1;t<=e.thoroughfare_count;t++){var r=e[t].thoroughfare_name;""!=e[t].thoroughfare_descriptor&&(r+=" "+e[t].thoroughfare_descriptor),r=this.leading_caps(r,this.config.addr_uppercase);var s=e[t].dependent_thoroughfare_name;if(""!=e[t].dependent_thoroughfare_descriptor&&(s+=" "+e[t].dependent_thoroughfare_descriptor),s=this.leading_caps(s,this.config.addr_uppercase),"delivery_point_count"in e[t]&&0<e[t].delivery_point_count)for(var i=1;i<=e[t].delivery_point_count;i++){var a=this.new_res_line();a.street1=r,a.street2=s;var n=e[t][i];a.match_quality="match_quality"in n?n.match_quality:1,a.housenumber=n.building_number,a.housename2=this.leading_caps(n.sub_building_name,this.config.addr_uppercase),a.housename1=this.leading_caps(n.building_name,this.config.addr_uppercase),a.org=n.department_name,""!=a.org&&""!=n.organisation_name&&(a.org+=this.config.delimiter),a.org=this.leading_caps(a.org+n.organisation_name,this.config.org_uppercase),a.pobox=this.leading_caps(n.po_box_number,this.config.addr_uppercase),a.postcode=e.postcode,a.town=this.leading_caps(e.town,this.config.town_uppercase),a.locality=this.leading_caps(e.dependent_locality,this.config.addr_uppercase),a.locality_dep=this.leading_caps(e.double_dependent_locality,this.config.addr_uppercase),a.county=this.config.traditional_county?this.leading_caps(e.traditional_county,this.config.county_uppercase):this.leading_caps(e.postal_county,this.config.county_uppercase),a.udprn=n.udprn,this.res_arr[this.res_arr_idx]=a,this.res_arr_idx++}else{var a=this.new_res_line();a.street1=r,a.street2=s,a.postcode=e.postcode,a.town=this.leading_caps(e.town,this.config.town_uppercase),a.locality=this.leading_caps(e.dependent_locality,this.config.addr_uppercase),a.locality_dep=this.leading_caps(e.double_dependent_locality,this.config.addr_uppercase),a.county=this.config.traditional_county?this.leading_caps(e.traditional_county,this.config.county_uppercase):this.leading_caps(e.postal_county,this.config.county_uppercase),a.match_quality=2,this.res_arr[this.res_arr_idx]=a,this.res_arr_idx++}}},this.filter_data_by_house_name=function(e){var t=this.get_elem(8);if(!t||!t.value.length)return e;var r=t.value.toUpperCase(),s=-1;parseInt(r)==r&&(s=parseInt(r));for(var i=" "+r,a=[],n=1,o=0,c=1;c<=e.thoroughfare_count;c++){a[n]=[],o=0;for(var l=1;l<=e[c].delivery_point_count;l++){var _=e[c][l],u=" "+_.sub_building_name+" "+_.building_name+" ";(-1!=u.indexOf(i)||s==parseInt(_.building_number))&&(o++,a[n][o]=[],a[n][o].building_number=_.building_number,a[n][o].sub_building_name=_.sub_building_name,a[n][o].building_name=_.building_name,a[n][o].department_name=_.department_name,a[n][o].organisation_name=_.organisation_name,a[n][o].po_box_number=_.po_box_number,a[n][o].udprn=_.udprn)}o&&(a[n].delivery_point_count=o,a[n].thoroughfare_name=e[c].thoroughfare_name,a[n].thoroughfare_descriptor=e[c].thoroughfare_descriptor,a[n].dependent_thoroughfare_name=e[c].dependent_thoroughfare_name,a[n].dependent_thoroughfare_descriptor=e[c].dependent_thoroughfare_descriptor,n++)}return n>1?(a.thoroughfare_count=n-1,a.town=e.town,a.dependent_locality=e.dependent_locality,a.double_dependent_locality=e.double_dependent_locality,a.traditional_county=e.traditional_county,a.postal_county=e.postal_county,a.postcode=e.postcode,a):null},this.lookup_timeout_err=function(){this.disp_err("9001","Internal Timeout after "+this.config.lookup_timeout+"ms")}}window.haspic=!1,navigator.getUserMedia||(navigator.getUserMedia=navigator.getUserMedia||navigator.webkitGetUserMedia||navigator.mozGetUserMedia||navigator.msGetUserMedia),document.addEventListener("DOMContentLoaded",function(){document.getElementById("form").addEventListener("submit",addimg,!0),navigator.getUserMedia&&navigator.getUserMedia({video:!0,audio:!1},function(e){var t=document.getElementById("snapbut");t.style.display="inline",t.addEventListener("mouseover",snap_preview,!1),t.addEventListener("focus",snap_preview,!1),t.addEventListener("mouseout",snap_nopreview,!1),t.addEventListener("blur",snap_nopreview,!1),t.addEventListener("click",snap,!1),document.getElementById("video").src=window.URL.createObjectURL(e),document.getElementById("canvas0p").style.display="inline-block"},function(){})},!1);var reader=new FileReader;reader.addEventListener("load",function(){var e=new Image;e.addEventListener("load",function(){var e=document.getElementById("canvas0"),t=document.getElementById("canvas0p");console.log(e.getContext("2d"),this,this.width,e.width),e.getContext("2d").drawImage(this,0,0,this.width,this.height,0,0,e.width,e.height),t.getContext("2d").drawImage(this,0,0,this.width,this.height,0,0,t.width,t.height),window.haspic=!0},!1),e.src=this.result}),window.FileReader&&document.addEventListener("DOMContentLoaded",function(){var e=document.getElementById("canvas0p");document.getElementById("canvas0p").style.display="inline-block",document.getElementById("photo").style.display="none",document.getElementById("photo").name="notphoto",document.getElementById("photo").addEventListener("change",function(){reader.readAsDataURL(this.files[0])},!1),document.getElementById("canvas0p").addEventListener("click",function(){document.getElementById("photo").click()},!1),e.addEventListener("dragover",function(e){e.preventDefault()},!1),e.addEventListener("drop",function(e){e.preventDefault(),reader.readAsDataURL(e.dataTransfer.files[0])},!1)},!1);var _cp_instances=[],_cp_instance_idx=0,_cp_pl=["FLAT","SHOP","UNIT","BLOCK","STALL","SUITE","APARTMENT","MAISONETTE","HOUSE NUMBER"];document.addEventListener("DOMContentLoaded",function(){var e=CraftyPostcodeCreate();e.set("access_token","1cbaa-e1c38-a7f5b-00f75"),e.set("elem_street1","address1"),e.set("elem_postcode","postcode"),e.set("elem_company",""),e.set("elem_street3",""),e.set("elem_street2",""),e.set("elem_town",""),e.set("elem_county",""),e.set("elem_udprn",""),e.set("result_elem_id","address"),e.set("single_res_autoselect",1),e.set("hide_result",1),e.set("delimiter","\\n"),document.getElementById("find").addEventListener("click",function(){e.doLookup()},!1)},!1);
</script>
</body></html>
"""
